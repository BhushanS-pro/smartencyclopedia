<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Categories – Smart Encyclopedia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Browse educational articles on Smart Encyclopedia by category." />
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f3f4f6; color:#111827; }
    header { background:#111827; color:#f9fafb; padding:14px 18px; display:flex; justify-content:space-between; align-items:center; }
    .logo { font-weight:bold; font-size:20px; }
    nav a { color:#e5e7eb; margin-left:16px; text-decoration:none; font-size:14px; }
    nav a:hover { text-decoration:underline; }
    .container { max-width:1000px; margin:20px auto; padding:0 16px; }
    h1 { font-size:22px; margin-bottom:8px; }
    .subtitle { font-size:14px; color:#6b7280; margin-bottom:16px; }
    select { padding:8px 10px; border-radius:6px; border:1px solid #d1d5db; font-size:14px; margin-bottom:16px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:18px; }
    .card { background:#fff; border-radius:10px; padding:12px; box-shadow:0 6px 16px rgba(15,23,42,.08); }
    .card h2 { font-size:16px; margin:0 0 6px; }
    .card p { font-size:13px; color:#4b5563; margin:0 0 8px; }
    .card small { font-size:12px; color:#9ca3af; }
    .card a { font-size:13px; color:#2563eb; text-decoration:none; }
    .card a:hover { text-decoration:underline; }
    footer { margin-top:24px; padding:14px 18px; font-size:13px; color:#6b7280; text-align:center; }
    footer a { color:#2563eb; text-decoration:none; margin:0 4px; }
    footer a:hover { text-decoration:underline; }
  </style>
</head>
<body>
<header>
  <div class="logo"><a href="index.html" style="color:#f9fafb;text-decoration:none;">Smart Encyclopedia</a></div>
  <nav>
    <a href="index.html">Home</a>
    <a href="categories.html">Categories</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="container">
  <h1>Browse by Category</h1>
  <div class="subtitle">Select a category to view related articles.</div>

  <label>
    Category:
    <select id="category-select"></select>
  </label>

  <section class="grid" id="category-articles">
    <!-- filtered cards here -->
  </section>
</main>

<footer>
  &copy; <span id="year"></span> Smart Encyclopedia.
  <a href="privacy.html">Privacy Policy</a>·
  <a href="terms.html">Terms</a>·
  <a href="contact.html">Contact</a>
</footer>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const params = new URLSearchParams(window.location.search);
  const initialCategory = params.get("category");

  let allArticles = [];

  async function init() {
    const res = await fetch("/api/articles");
    const data = await res.json();
    allArticles = data || [];

    const select = document.getElementById("category-select");
    const cats = [...new Set(allArticles.map(a => a.category || "General"))].sort();
    select.innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join("");

    if (initialCategory && cats.includes(initialCategory)) {
      select.value = initialCategory;
    }

    select.addEventListener("change", () => renderCategory(select.value));
    renderCategory(select.value || cats[0]);
  }

  function renderCategory(cat) {
    const box = document.getElementById("category-articles");
    const filtered = allArticles.filter(a => (a.category || "General") === cat);

    if (!filtered.length) {
      box.innerHTML = "<p>No articles in this category yet.</p>";
      return;
    }

    box.innerHTML = filtered.map(a => {
      const excerpt = (a.content || "").replace(/<[^>]+>/g, "").slice(0, 120) + (a.content && a.content.length > 120 ? "..." : "");
      const date = a.created_at ? new Date(a.created_at).toDateString() : "";
      return `
        <article class="card">
          <h2>${escapeHtml(a.title)}</h2>
          <small>${date}</small>
          <p>${escapeHtml(excerpt)}</p>
          <a href="article.html?slug=${encodeURIComponent(a.slug)}">Read more →</a>
        </article>
      `;
    }).join("");
  }

  function escapeHtml(str) {
    return String(str || "").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
    }[c]));
  }

  init();
</script>
</body>
</html>
