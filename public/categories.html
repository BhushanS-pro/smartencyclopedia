<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Categories – Smart Encyclopedia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin:0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background:#f3f4f6; color:#111827; }
    header { background:#ffffff; border-bottom:1px solid #e5e7eb; padding:12px 18px; display:flex; justify-content:space-between; align-items:center; }
    .brand { font-weight:700; font-size:20px; }
    nav a { margin-left:16px; text-decoration:none; font-size:14px; color:#6b7280; }
    nav a:hover { color:#2563eb; }
    .container { max-width:1040px; margin:18px auto 30px; padding:0 12px; }
    h1 { font-size:22px; margin:0 0 10px; }
    .cat-list { display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 18px; }
    .cat-pill {
      padding:6px 10px; border-radius:999px; border:1px solid #d1d5db;
      background:#ffffff; font-size:13px; cursor:pointer; color:#374151;
    }
    .cat-pill.active { background:#2563eb; color:#ffffff; border-color:#2563eb; }
    .cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(230px,1fr)); gap:14px; }
    .card { background:#ffffff; border-radius:10px; padding:10px 10px 12px; text-decoration:none; color:inherit; box-shadow:0 8px 24px rgba(15,23,42,0.06); }
    .card-title { font-size:15px; font-weight:600; margin-bottom:4px; }
    .card-meta { font-size:11px; color:#6b7280; }
  </style>
</head>
<body>
<header>
  <div class="brand">Smart Encyclopedia</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="categories.html">Categories</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="container">
  <h1>Categories</h1>
  <div id="cat-list" class="cat-list"></div>
  <div id="articles" class="cards"></div>
</main>

<script>
  const API_BASE = window.location.origin;
  const catListEl = document.getElementById("cat-list");
  const articlesEl = document.getElementById("articles");
  let allArticles = [];
  let activeCategory = "All";

  async function init() {
    try {
      const res = await fetch(API_BASE + "/api/articles");
      const data = await res.json();
      allArticles = Array.isArray(data) ? data : [];
      buildCategories();
      renderArticles();
    } catch (e) {
      articlesEl.innerHTML = "<p>Unable to load articles.</p>";
    }
  }

  function buildCategories() {
    const cats = new Set(["All"]);
    allArticles.forEach(a => { if (a.category) cats.add(a.category); });
    catListEl.innerHTML = "";
    cats.forEach(cat => {
      const btn = document.createElement("button");
      btn.textContent = cat;
      btn.className = "cat-pill" + (cat === activeCategory ? " active" : "");
      btn.addEventListener("click", () => {
        activeCategory = cat;
        document.querySelectorAll(".cat-pill").forEach(p => p.classList.remove("active"));
        btn.classList.add("active");
        renderArticles();
      });
      catListEl.appendChild(btn);
    });
  }

  function renderArticles() {
    let list = allArticles;
    if (activeCategory !== "All") {
      list = list.filter(a => a.category === activeCategory);
    }
    if (!list.length) {
      articlesEl.innerHTML = "<p>No articles for this category yet.</p>";
      return;
    }
    articlesEl.innerHTML = list.map(a => `
      <a class="card" href="article.html?slug=${encodeURIComponent(a.slug)}">
        <div class="card-title">${escapeHtml(a.title)}</div>
        <div class="card-meta">${a.category || "General"} · ${a.created_at ? new Date(a.created_at).toDateString() : ""}</div>
      </a>
    `).join("");
  }

  function escapeHtml(str) {
    return String(str || "").replace(/[&<>"]/g, c => (
      { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c]
    ));
  }

  init();
</script>
</body>
</html>
