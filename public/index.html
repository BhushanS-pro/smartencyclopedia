<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Encyclopedia – Daily Knowledge Articles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Smart Encyclopedia – daily educational articles on science, space, history, technology, geography and more." />
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f3f4f6; color:#111827; }
    header { background:#111827; color:#f9fafb; padding:14px 18px; display:flex; align-items:center; justify-content:space-between; }
    header .logo { font-weight:bold; font-size:20px; }
    nav a { color:#e5e7eb; margin-left:16px; text-decoration:none; font-size:14px; }
    nav a:hover { text-decoration:underline; }
    .container { max-width:1100px; margin:20px auto; padding:0 16px; }
    h1 { font-size:24px; margin-bottom:10px; }
    .subtitle { color:#6b7280; margin-bottom:20px; font-size:14px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:18px; }
    .card { background:#fff; border-radius:10px; padding:12px; box-shadow:0 6px 16px rgba(15,23,42,.08); display:flex; flex-direction:column; height:100%; }
    .card img { width:100%; height:150px; object-fit:cover; border-radius:8px; margin-bottom:10px; }
    .card h2 { font-size:16px; margin:0 0 6px; }
    .card p { font-size:13px; color:#4b5563; margin:0 0 8px; }
    .card small { font-size:12px; color:#9ca3af; }
    .card a.read-more { margin-top:auto; align-self:flex-start; font-size:13px; color:#2563eb; text-decoration:none; }
    .card a.read-more:hover { text-decoration:underline; }
    .categories { margin-bottom:16px; }
    .categories span { font-size:13px; color:#6b7280; margin-right:6px; }
    .cat-pill { display:inline-block; margin:4px 6px 4px 0; padding:4px 10px; border-radius:999px; border:1px solid #d1d5db; font-size:12px; cursor:pointer; background:#fff; }
    .cat-pill:hover { background:#e5e7eb; }
    footer { margin-top:24px; padding:14px 18px; font-size:13px; color:#6b7280; text-align:center; }
    footer a { color:#2563eb; text-decoration:none; margin:0 4px; }
    footer a:hover { text-decoration:underline; }
  </style>
</head>
<body>
<header>
  <div class="logo">Smart Encyclopedia</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="categories.html">Categories</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="container">
  <h1>Daily Knowledge Articles</h1>
  <div class="subtitle">Explore educational articles across science, space, history, technology and more.</div>

  <div class="categories" id="category-pills">
    <span>Popular categories:</span>
    <!-- category pills injected here -->
  </div>

  <section class="grid" id="articles-grid">
    <!-- article cards injected here -->
  </section>
</main>

<footer>
  &copy; <span id="year"></span> Smart Encyclopedia.
  <a href="privacy.html">Privacy Policy</a>·
  <a href="terms.html">Terms</a>·
  <a href="contact.html">Contact</a>
</footer>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  async function loadArticles() {
    try {
      const res = await fetch("/api/articles");
      if (!res.ok) throw new Error("Failed to load articles");
      const data = await res.json();

      const grid = document.getElementById("articles-grid");
      const catBox = document.getElementById("category-pills");

      if (!data.length) {
        grid.innerHTML = "<p>No articles yet. Please add some from the admin panel.</p>";
        return;
      }

      // Build cards
      grid.innerHTML = data.map(a => {
        const img = a.image_url || "https://via.placeholder.com/600x400?text=Smart+Encyclopedia";
        const excerpt = (a.content || "").replace(/<[^>]+>/g, "").slice(0, 140) + (a.content && a.content.length > 140 ? "..." : "");
        const cat = a.category || "General";
        const date = a.created_at ? new Date(a.created_at).toDateString() : "";
        return `
          <article class="card">
            <img src="${img}" alt="${a.title}">
            <h2>${escapeHtml(a.title)}</h2>
            <small>${escapeHtml(cat)} ${date ? "&middot; " + date : ""}</small>
            <p>${escapeHtml(excerpt)}</p>
            <a class="read-more" href="article.html?slug=${encodeURIComponent(a.slug)}">Read more →</a>
          </article>
        `;
      }).join("");

      // Build category pills
      const cats = [...new Set(data.map(a => a.category || "General"))];
      catBox.innerHTML = '<span>Popular categories:</span>' + cats.map(c => `
        <button class="cat-pill" onclick="gotoCategory('${encodeURIComponent(c)}')">${escapeHtml(c)}</button>
      `).join("");

    } catch (err) {
      document.getElementById("articles-grid").innerHTML = "<p>Error loading articles.</p>";
      console.error(err);
    }
  }

  function gotoCategory(cat) {
    window.location.href = "categories.html?category=" + cat;
  }

  function escapeHtml(str) {
    return String(str || "").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
    }[c]));
  }

  loadArticles();
</script>
</body>
</html>
