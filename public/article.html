<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Article – Smart Encyclopedia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin:0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background:#f3f4f6; color:#111827; }
    header { background:#ffffff; border-bottom:1px solid #e5e7eb; padding:12px 18px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:20; }
    .brand { font-weight:700; font-size:20px; }
    nav a { margin-left:16px; text-decoration:none; font-size:14px; color:#6b7280; }
    nav a:hover { color:#2563eb; }
    .container { max-width:840px; margin:18px auto 30px; padding:0 12px; }
    .meta { font-size:13px; color:#6b7280; margin-bottom:8px; }
    .hero-img { width:100%; max-height:320px; object-fit:cover; border-radius:12px; margin:10px 0 14px; background:#e5e7eb; }
    h1 { font-size:24px; margin:0 0 6px; }
    article { background:#ffffff; border-radius:12px; padding:16px 16px 20px; box-shadow:0 8px 24px rgba(15,23,42,0.06); }
    article p { line-height:1.6; font-size:15px; }
    article h2 { margin-top:18px; font-size:18px; }
  </style>
</head>
<body>
<header>
  <div class="brand">Smart Encyclopedia</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="categories.html">Categories</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="container">
  <article id="article">
    <p>Loading article...</p>
  </article>
</main>

<script>
  const API_BASE = window.location.origin;
  const params = new URLSearchParams(window.location.search);
  const slug = params.get("slug");
  const articleEl = document.getElementById("article");

  if (!slug) {
    articleEl.innerHTML = "<p>Article not found (missing slug).</p>";
  } else {
    loadArticle(slug);
  }

  async function loadArticle(slug) {
    try {
      const res = await fetch(`${API_BASE}/api/article/${encodeURIComponent(slug)}`);
      const article = await res.json();
      if (!article || !article.title) {
        articleEl.innerHTML = "<p>Article not found.</p>";
        return;
      }
      const date = article.created_at ? new Date(article.created_at).toDateString() : "";
      const img = article.image_url || "https://via.placeholder.com/800x400.png?text=Smart+Encyclopedia";

      document.title = article.title + " – Smart Encyclopedia";

      articleEl.innerHTML = `
        <div class="meta">${article.category || "General"} • ${date}</div>
        <h1>${escapeHtml(article.title)}</h1>
        <img src="${img}" alt="${escapeHtml(article.title)}" class="hero-img" />
        <div class="meta">Smart Encyclopedia · Simple explanations, every day.</div>
        <div class="body">${article.content || ""}</div>
      `;
    } catch (e) {
      articleEl.innerHTML = "<p>Error loading article.</p>";
    }
  }

  function escapeHtml(str) {
    return String(str || "").replace(/[&<>"]/g, c => (
      { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c]
    ));
  }
</script>
</body>
</html>
